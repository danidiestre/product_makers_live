name: Discord Push & Deploy Notification

on:
  push:
    branches:
      - main
  deployment_status:

jobs:
  notify-push:
    runs-on: ubuntu-latest
    if: github.event_name == 'push'
    steps:
      - name: Checkout code
        uses: actions/checkout@v3

      - name: Discord Push Notification
        uses: Ilshidur/action-discord@master
        env:
          DISCORD_WEBHOOK: ${{ secrets.DISCORD_WEBHOOK }}
        with:
          args: 'ğŸš€ **Nuevo commit pusheado a main!**

           ğŸ“ Commit: **${{ github.event.head_commit.message }}**
           ğŸ‘©â€ğŸ’» Autor: **${{ github.event.head_commit.author.name }}**
           ğŸ”— Ver cambios: ${{ github.event.head_commit.url }}
           â³ El deploy en Vercel comenzarÃ¡ automÃ¡ticamente...'

  notify-deploy:
    runs-on: ubuntu-latest
    if: github.event_name == 'deployment_status'
    steps:
      - name: Discord Deploy Notification
        uses: Ilshidur/action-discord@master
        env:
          DISCORD_WEBHOOK: ${{ secrets.DISCORD_WEBHOOK }}
        with:
          args: |
            ${{ github.event.deployment_status.state == 'success' 
              && 'ğŸ‰ **Â¡Deploy completado con Ã©xito!**\n\nğŸŒ URL: ' + github.event.deployment_status.environment_url + '\nâ±ï¸ Ambiente: ' + github.event.deployment_status.environment
              || 'âŒ **El deploy ha fallado**\n\nğŸ” Estado: ' + github.event.deployment_status.description }} 